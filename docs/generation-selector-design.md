# ポケモン世代選択機能 拡張設計書（プルダウン版）

## 概要
ポケモン図鑑の世代選択機能を拡張し、第1世代から第6世代までのポケモンをプルダウンメニューで切り替えて表示できるようにする。

## 要件

### 機能要件
- 第1世代（1-151）、第2世代（152-251）、第3世代（252-386）、第4世代（387-493）、第5世代（494-649）、第6世代（650-721）のポケモンをAPIから取得
- **プルダウンボタン**で世代選択UIを実装
- 選択ボタンを押すことで世代の切り替えが可能
- 世代切り替え時は、選択した世代のポケモンのみを表示
- 検索機能も選択中の世代のポケモンのみを対象とする
- 出力状態（表示形式）は変更なし

### UI/UX要件
- 世代選択はプルダウンメニューで実装（「第1世代」〜「第6世代」）
- プルダウンボタンには現在選択中の世代を表示
- メニューを開くと全世代の選択肢が表示される
- 選択中の世代にはチェックマークを表示
- 世代切り替え時は選択中のポケモンをリセットし、新しい世代の最初のポケモンを表示
- ローディング状態を表示
- レスポンシブ対応

### 非機能要件
- **テストは厳格に**: 世代切り替え時に他の世代のポケモンが混ざらないように取得・表示
- パフォーマンス: 世代切り替え時のローディングは最小限に
- データの一貫性: 世代ごとに完全にデータをクリアして再取得

## 技術設計

### ポケモン世代の定義

```typescript
type Generation = 1 | 2 | 3 | 4 | 5 | 6;

const GENERATION_CONFIG = {
  1: {
    label: "第1世代",
    startId: 1,
    endId: 151,
    count: 151,
  },
  2: {
    label: "第2世代",
    startId: 152,
    endId: 251,
    count: 100,
  },
  3: {
    label: "第3世代",
    startId: 252,
    endId: 386,
    count: 135,
  },
  4: {
    label: "第4世代",
    startId: 387,
    endId: 493,
    count: 107,
  },
  5: {
    label: "第5世代",
    startId: 494,
    endId: 649,
    count: 156,
  },
  6: {
    label: "第6世代",
    startId: 650,
    endId: 721,
    count: 72,
  },
} as const;
```

### プルダウンメニューの設計

プルダウンメニューは、以下の特徴を持つUIコンポーネント：
- 省スペース：6つの選択肢をコンパクトに表示
- 現在の選択がボタンに表示される
- クリックでメニューが開き、全選択肢が表示される
- 選択中の項目にチェックマーク表示
- キーボードナビゲーション対応

#### プルダウンメニューのスタイル仕様

**トリガーボタン**:
- 背景: 白（bg-white）
- ボーダー: グレー（border border-gray-300）
- パディング: px-4 py-2
- 角丸: rounded-lg
- アイコン: ChevronDown（下向き矢印）
- ホバー時: 軽いグレー背景

**メニュー**:
- 背景: 白（bg-white）
- シャドウ: shadow-lg
- ボーダー: border border-gray-200
- 角丸: rounded-lg
- 最大高さ: max-h-60
- オーバーフロー: overflow-auto

**メニュー項目**:
- パディング: px-4 py-2
- ホバー時: 背景色変更（bg-gray-100）
- 選択中: チェックマークアイコン表示
- トランジション: スムーズなアニメーション

### UI構造

```
ModernPokedex
├── Header
│   ├── Dropdown Menu（世代選択）
│   │   ├── Trigger Button（現在選択中の世代を表示）
│   │   └── Menu Content
│   │       ├── MenuItem "第1世代"
│   │       ├── MenuItem "第2世代"
│   │       ├── MenuItem "第3世代"
│   │       ├── MenuItem "第4世代"
│   │       ├── MenuItem "第5世代"
│   │       └── MenuItem "第6世代"
│   └── Search Icon Button
├── SearchModal（世代対応）
└── Main Content
```

### 実装ファイル

#### 修正
- `src/app/page.tsx`:
  - `Generation` 型を `1 | 2 | 3 | 4 | 5 | 6` に拡張
  - `GENERATION_CONFIG` に第5世代と第6世代を追加
  - Segmented Controlをプルダウンメニューに置き換え

#### 新規作成
- なし（既存コンポーネントの修正のみ、シンプルなプルダウンを実装）

### ヘッダーレイアウト

**修正前（Segmented Control）**:
```
┌──────────────────────────────────────────────────────────┐
│ ┌─────────────────────────────────────────┐        [🔍] │
│ │ 第1世代 │ 第2世代 │ 第3世代 │ 第4世代 │              │
│ └─────────────────────────────────────────┘              │
└──────────────────────────────────────────────────────────┘
```

**修正後（プルダウン）**:
```
┌──────────────────────────────────────────┐
│ [第1世代 ▼]                       [🔍] │
└──────────────────────────────────────────┘
     │
     ├─ 第1世代 ✓
     ├─ 第2世代
     ├─ 第3世代
     ├─ 第4世代
     ├─ 第5世代
     └─ 第6世代
```

## 実装コード

### プルダウンメニューの実装（page.tsx内）

```tsx
{/* プルダウンメニュー - 世代選択 */}
<div className="relative">
  <button
    onClick={() => setIsDropdownOpen(!isDropdownOpen)}
    className="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
  >
    <span className="font-medium">{GENERATION_CONFIG[currentGeneration].label}</span>
    <ChevronDown className="w-4 h-4 text-gray-600" />
  </button>

  {isDropdownOpen && (
    <>
      {/* オーバーレイ */}
      <div
        className="fixed inset-0 z-10"
        onClick={() => setIsDropdownOpen(false)}
      />

      {/* メニュー */}
      <div className="absolute left-0 top-full mt-1 z-20 bg-white border border-gray-200 rounded-lg shadow-lg min-w-[160px] max-h-60 overflow-auto">
        {([1, 2, 3, 4, 5, 6] as const).map((gen) => (
          <button
            key={gen}
            onClick={() => {
              handleGenerationChange(gen);
              setIsDropdownOpen(false);
            }}
            className="w-full flex items-center justify-between px-4 py-2 hover:bg-gray-100 transition-colors text-left"
          >
            <span className="font-medium">{GENERATION_CONFIG[gen].label}</span>
            {currentGeneration === gen && (
              <Check className="w-4 h-4 text-blue-500" />
            )}
          </button>
        ))}
      </div>
    </>
  )}
</div>
```

## テスト方針

### 厳格なテスト項目

1. **世代の分離**
   - 第1世代選択時: ID 1-151 のみ表示
   - 第2世代選択時: ID 152-251 のみ表示
   - 第3世代選択時: ID 252-386 のみ表示
   - 第4世代選択時: ID 387-493 のみ表示
   - 第5世代選択時: ID 494-649 のみ表示
   - 第6世代選択時: ID 650-721 のみ表示
   - 世代切り替え時に前の世代のデータが残らない

2. **データの一貫性**
   - リストに表示されるポケモンは全て選択中の世代
   - 検索結果も選択中の世代のポケモンのみ
   - 「もっと見る」で追加されるポケモンも選択中の世代

3. **境界値のテスト**
   - 第1世代の最後（No.151 ミュウ）
   - 第2世代の最初（No.152 チコリータ）
   - 第2世代の最後（No.251 セレビィ）
   - 第3世代の最初（No.252 キモリ）
   - 第3世代の最後（No.386 デオキシス）
   - 第4世代の最初（No.387 ナエトル）
   - 第4世代の最後（No.493 アルセウス）
   - 第5世代の最初（No.494 ツタージャ）
   - 第5世代の最後（No.649 ゲノセクト）
   - 第6世代の最初（No.650 ハリマロン）
   - 第6世代の最後（No.721 ボルケニオン）

4. **状態管理のテスト**
   - 世代切り替え時に選択中のポケモンがリセットされる
   - 世代切り替え時にリストがクリアされる
   - 世代切り替え時に検索用データがクリアされる

5. **UI動作のテスト**
   - プルダウンメニューの開閉が正しく動作する
   - 選択中の世代にチェックマークが表示される
   - メニュー外クリックでメニューが閉じる
   - 同じ世代を再選択しても無駄な処理が走らない
   - ローディング中は適切な表示がされる

## 実装手順

1. **型定義の拡張**
   - `Generation` 型を `1 | 2 | 3 | 4 | 5 | 6` に変更

2. **世代設定の追加**
   - `GENERATION_CONFIG` に第5世代と第6世代を追加

3. **状態管理の追加**
   - `isDropdownOpen` state を追加

4. **プルダウンメニューの実装**
   - Segmented Controlをプルダウンメニューに置き換え
   - トリガーボタンの実装
   - メニュー項目を動的に生成（mapを使用）
   - オーバーレイとメニュー外クリックの処理

5. **必要なアイコンのimport**
   - `ChevronDown` をlucide-reactからimport
   - `Check` をlucide-reactからimport

6. **動作確認**
   - 各世代を選択して正しく切り替わるか確認
   - 世代ごとのポケモンIDが正しい範囲内か確認
   - データが混ざらないか確認

7. **型チェックとリント**
   - `npm run typecheck` を実行
   - `npm run lint` を実行

## 注意事項

- 世代切り替え時は必ず全データをクリアしてから新しいデータを取得
- `useEffect` の依存配列に `currentGeneration` を追加（既に実装済み）
- API呼び出しのoffsetは `startId - 1`（PokeAPIは0始まり）
- 既存の世代切り替えロジック（`handleGenerationChange`）はそのまま使用可能
- プルダウンメニューは `z-index` を適切に設定し、他の要素の上に表示
- メニュー外クリックでメニューを閉じる処理を実装
- エラーハンドリングを適切に実装
- ローディング状態を適切に管理

## 将来の拡張性

将来的に第7世代以降を追加する場合:
- `GENERATION_CONFIG` に新しい世代を追加
- `Generation` 型を拡張（`type Generation = 1 | 2 | ... | 7 | ...`）
- プルダウンメニューのmap配列に世代番号を追加
- 世代が増えてもプルダウン形式なら省スペースで対応可能

## まとめ

この実装により：
- ユーザーは第1世代から第6世代までのポケモンをシームレスに切り替えられる
- プルダウンメニューにより、省スペースで6つの選択肢を提供
- 既存の世代切り替えロジックを活用し、データの混在を確実に防ぐ
- テストは厳格に行い、世代間でデータが混ざらないことを保証
- 第5世代と第6世代の新しいポケモンも正しく表示できる
